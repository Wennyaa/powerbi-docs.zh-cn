---
title: Microsoft Power BI Premium 容量方案
description: 描述常见 Power BI Premium 容量方案。
author: mgblythe
ms.author: mblythe
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-admin
ms.topic: conceptual
ms.date: 04/09/2019
ms.custom: seodec18
LocalizationGroup: Premium
ms.openlocfilehash: 1d666a6702515a935d93549d026f207848f2bca8
ms.sourcegitcommit: 60dad5aa0d85db790553e537bf8ac34ee3289ba3
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/29/2019
ms.locfileid: "65565359"
---
# <a name="premium-capacity-scenarios"></a>Premium 容量方案

本文介绍实际方案实现了 Power BI 高级容量。 常见的问题和挑战所述，还如何识别问题，并帮助解决这些问题：

- [使数据集保持最新](#keeping-datasets-up-to-date)
- [识别速度缓慢响应数据集](#identifying-slow-responding-datasets)
- [识别原因偶尔缓慢的响应数据集](#identifying-causes-for-sporadically-slow-responding-datasets)
- [确定是否有足够的内存](#determining-whether-there-is-enough-memory)
- [确定是否有足够的 CPU](#determining-whether-there-is-enough-cpu)

步骤，以及图表和表的示例取自**Power BI Premium 容量度量值应用**Power BI 管理员将有权访问。

## <a name="keeping-datasets-up-to-date"></a>使数据集保持最新

在此方案中，当用户抱怨报表数据有时似乎是旧的或"过时"时触发调查。

在应用中，管理员与进行交互**刷新**视觉对象，对数据集的排序**最大等待时间**降序排序的统计信息。 此视觉对象有助于他们显示具有最长等待时间，按工作区名称分组的数据集。

![按降序最长等待时间，按工作区分组的数据集刷新](media/service-premium-capacity-scenarios/dataset-refreshes.png)

在中**每小时平均刷新等待时间**视觉对象，客户发现刷新等待时间一致地高峰下午 4 点左右每一天。

![刷新在峰值等待定期下午 4 点](media/service-premium-capacity-scenarios/peak-refresh-waits.png)

有几个可能的原因，对于这些结果：

- 尝试输入太多次刷新可能发生在同一时间超出容量节点定义的限制。 在这种情况下，与 p1 的六个并发刷新的默认内存分配。

- 要刷新的数据集可能太大，无法装入可用内存 （需要至少 2 个完全刷新所需的内存）。
- 效率低下的 Power Query 逻辑可能会在数据集刷新期间导致内存使用率峰值。 上一个繁忙的能力，此峰值偶尔会到达物理限制，故障刷新，并且可能会影响其他报表查看操作的容量。
- 经常查询需要保留在内存中的数据集可能会影响其他数据集的刷新由于有限的可用内存的功能。

若要帮助调查，Power BI 管理员可以查看：

- 可用内存不足时的数据刷新时可用内存小于 2 倍要刷新的数据集的大小。
- 数据集不刷新和不在内存中刷新之前，尚未立即显示交互式流量在大量的刷新时间。 若要查看在任何给定时间哪个数据集加载到内存，Power BI 管理员可以查看的数据集区域**数据集**应用中的选项卡。 管理员然后可以通过单击其中一个中的条形交叉筛选器添加到某一时刻**每小时加载数据集计数**。 下图中所示将本地峰值指示多个数据集加载到内存中，这可能会延迟的计划的刷新开始时一小时。
- 计划数据刷新开始时，增加数据集逐出采用放置。 已通过提供太多不同的交互式报表刷新的时间之前导致高内存压力逐出可以那里指示。 **每小时的数据集逐出和内存消耗**视觉对象可以清楚地指示中逐出的峰值。

下图显示本地图文场中加载数据集，这表明交互式查询延迟刷新的启动。 选择一段时间**每小时加载数据集计数**视觉对象将交叉筛选器**数据集大小**visual。

![加载数据集，本地出现峰值表明刷新的交互式查询延迟式的启动](media/service-premium-capacity-scenarios/hourly-loaded-dataset-counts.png)

Power BI 管理员可以尝试通过采取措施以确保有足够的内存可用于数据刷新首先解决该问题：

- 联系数据集所有者和询问他们分阶段以及隔开数据刷新计划。
- 减少数据集查询负载通过删除不必要的仪表板或仪表板磁贴，尤其是那些以强制实施行级别安全性。
- 通过优化 Power Query 逻辑来加快数据刷新。 提高建模计算的列或表。 减少数据集大小，或配置更大的数据集执行增量数据刷新。

## <a name="identifying-slow-responding-datasets"></a>识别速度缓慢响应数据集

在此方案中，调查开始时用户抱怨某些报表时间太长，若要打开，并且有时会挂起。

在应用中，Power BI 管理员可以使用**查询持续时间**视觉对象，确定通过对数据集按降序进行排序的性能最坏的数据集**平均持续时间**。 此视觉对象还显示了数据集查询计数，以便您可以看到数据集查询的频率。

![坏的情况下执行的数据集](media/service-premium-capacity-scenarios/worst-performing-datasets.png)

管理员可以指**查询持续时间分布**视觉对象，则它显示了由 bucket 存储的查询性能的整体分布 (< = 30ms，0-100 毫秒) 的已筛选的时间段。 通常情况下，查询，采用一秒或更少视为响应式大多数用户;往往会花费更长时间的查询创建的错误的性能体验。

**每小时查询持续时间分布**视觉对象，Power BI 管理员可以确定一个小时的时间段时容量性能可能具有已识别人不满意。 越大栏段表示查询持续时间超过一秒，较大的用户能够体会到性能不佳的风险。

视觉对象是交互式课程，并且在栏的段被选定时，相应**查询持续时间**表报表页上视觉对象进行交叉筛选，以显示它所代表的数据集。 此交叉筛选，Power BI 管理员可以轻松地识别该数据集响应速度慢。

下图显示了通过筛选一个视觉对象**每小时查询持续时间分布**，专注于一小时存储桶中的坏的情况下执行数据集。 

![筛选每小时查询持续时间分布 visual 显示了执行数据集变得更糟](media/service-premium-capacity-scenarios/hourly-query-duration-distributions.png)

一旦确定中特定一小时时间跨度不佳的性能数据集，Power BI 管理员可以调查性能不佳导致的重载的容量，还是由于效果不佳设计数据集或报表。 其可以引用**查询等待时间**视觉对象，并按降序平均查询等待时间排序数据集。 如果大量查询正在等待，过多的查询等待的原因可能是数据集的高需求。 如果平均查询等待时间是大量 （> 100 毫秒），则可能需要查看的数据集和报表以查看是否可以进行优化。 例如，对于较少的视觉对象上指定报表页或 DAX 表达式优化。

![查询等待时间视觉对象有助于揭示效率不高的数据集](media/service-premium-capacity-scenarios/query-wait-times.png)

有的数据集中的查询等待时间累积多个可能的原因：

- 并非最佳的模型设计、 度量值表达式或甚至报表设计的所有情况下，可能会导致长时间运行的查询占用的 CPU 的高级别。 这会强制新查询等待，直到 CPU 线程变为可用，可以创建过程在高峰业务时段期间的常见保护效果 （思考流量卡纸问题）。 **查询等待**页将是主要的资源，以确定数据集是否具有较高的平均查询等待时间。
- 大量并发容量用户 （几百到几千） 使用相同的报表或数据集。 超出了并发的阈值，甚至设计良好的数据集可以执行错误。 这通常由显示明显更高的值，用于对查询进行计数比其他数据集显示单个数据集 (例如，300 K 查询的一个数据集相比 < 30 K 对于所有其他数据集的查询)。 在某一时刻的查询等待此数据集将启动错开，以确保在中可以看到**查询持续时间**visual。
- 许多不同查询的数据集，如频繁周期入和移出内存的数据集，从而导致抖动。 这会导致用户数据集加载到内存时遇到性能变慢。 若要确认，Power BI 管理员可以参考**每小时的数据集逐出和内存消耗**视觉对象，这可能指示大量的数据集加载到内存重复中逐出。

## <a name="identifying-causes-for-sporadically-slow-responding-datasets"></a>识别原因偶尔缓慢的响应数据集

在此方案中，调查开始时用户所述，报表视觉对象有时较长的响应，或可能会变得无响应，但在其他情况下它们是可以接受响应。

在应用中，**查询持续时间**部分用于按以下方式找到问题所在的数据集：

- 在中**查询持续时间**visual 管理员筛选数据集 （从查询顶部的数据集） 的数据集和检查中的交叉筛选的条形**每小时查询分发**visual。
- 当单个一小时条形显示在与该数据集的其他一小时条形图的所有查询持续时间组之间的比率的重大更改 （例如，颜色之间的比率更改极大地），则表示此数据集演示中的偶发更改性能。
- 显示较差的查询，具有不规则部分一小时条指示该数据集已受到干扰性邻居效果，由其他数据集的活动导致一个时间跨度。

下图显示在 1 月 30 日的一小时的数据集的性能明显退步发生，指示大小"（3,10s]"执行持续时间存储桶。 单击该一小时条形图将显示所有数据集加载到内存中，在此期间，显示可能导致干扰性邻居效果的数据集。

![条形图显示了很大一部分最差的性能](media/service-premium-capacity-scenarios/worst-performing-queries.png)

后 （例如，在过程中在上图中的 1 月第 30) 标识有问题的时间跨度的 Power BI 管理员可以删除所有数据集筛选器，然后仅按该 timespan，用于确定在此期间主动查询哪些数据集进行筛选。 干扰邻居效果原因数据集通常是 top 查询数据集或一个具有最长平均查询持续时间。

此问题的解决方案可能是将通过不同的工作区在不同的高级容量，或如果数据集大小、 消耗要求和数据刷新模式共享容量上的数据集的原因。

反过来也可能是，则返回 true。 Power BI 管理员无法识别数据集查询性能大幅提高的时间，然后寻找什么消失。 如果在该点缺少某些信息，然后，可能有助于指向导致出现问题。

## <a name="determining-whether-there-is-enough-memory"></a>确定是否有足够的内存

若要确定是否有足够的内存来完成其工作负荷的容量，Power BI 管理员可以参考**占用的内存百分比**的视觉对象**数据集**应用的选项卡。 **所有**（总计） 的内存表示数据集加载到内存中，无论它们是主动查询或处理所占用的内存。 **Active**内存表示正在主动处理的数据集所占用的内存。

在正常容量视觉对象将如下所示，其中显示所有 （总计） 之间的间距和活动内存：

![正常产能会显示所有 （总计） 之间的间距和活动内存](media/service-premium-capacity-scenarios/memory-healthy-capacity.png)

在容量中遇到内存不足的情况，相同的视觉对象清晰显示活动内存和聚合，这意味着它不可能将其他数据集，然后加载到内存的内存总量。 Power BI 管理员可以在这种情况下，单击**容量重启**(在**高级选项**的管理门户的容量设置区域)。 从内存刷新并允许其重新加载到内存中作为必需 （通过查询或数据刷新），在中所有数据集正在重新启动容量结果。

![活动内存正与 * * All * * 内存](media/service-premium-capacity-scenarios/memory-unhealthy-capacity.png)

## <a name="determining-whether-there-is-enough-cpu"></a>确定是否有足够的 CPU

一般情况下，容量的平均 CPU 使用率应保持低于 80%。 超出此值意味着容量即将达到 CPU 饱和所致。

由多的时间，因为它尝试处理的所有操作执行很多 CPU 上下文切换的容量的时间长的操作表示的 CPU 饱和度的效果。 在具有很多并发查询的高级容量，这会指示由较高的查询等待时间。 较高的查询等待时间的结果是比平常慢的响应能力。 通过查看 CPU 处于满负荷状态时，Power BI 管理员可以轻松地识别**每小时查询等待时间分布区**visual。 定期峰值的查询等待的时间计数指示潜在 CPU 饱和所致。

![定期峰值的查询等待的时间计数指示潜在的 CPU 饱和度](media/service-premium-capacity-scenarios/peak-query-wait-times.png)

类似的模式有时可以检测在后台操作，如果他们参与 CPU 饱和所致。 Power BI 管理员可以在特定的数据集，并可表示时的 CPU 饱和度 （可能由于其他正在进行的数据集刷新和/或交互式查询） 的刷新时间中查找定期出现峰值。 在此情况下，指**系统**应用中的视图不会一定透露 CPU 已达到其 100%。 **系统**视图显示每小时平均值，但 CPU 可以变得满负荷状态几分钟的繁重的操作，这显示为峰值在等待时间。

有更多的细微差别，看到的 CPU 饱和度效果。 虽然等待的查询数很重要，查询等待时间将始终执行的操作在某种程度上而不会导致明显的性能下降。 更容易出现 CPU 饱和所致的效果比其他某些数据集 （具有更长的平均查询时，指示复杂性或大小）。 若要轻松识别这些数据集，Power BI 管理员可以查看中的条形的颜色组合中的更改**每小时的等待时间分发**visual。 后发现离群值栏，它们可以寻找具有查询等待这段时间内的数据集，并查找在进行比较以平均查询持续时间的平均查询等待时间。 如果这两个指标是相同的量级，数据集的查询工作负荷很重要的则可能的资源不足的 CPU 所影响的数据集。

在短大量导致在每个迸发期间的 CPU 饱和度高频率 （例如，在培训会话） 的多个用户查询中使用数据集时，这种效果可能会变得尤为明显。 在这种情况下，此数据集上的重要查询等待时间即可体验以及影响容量 （干扰性邻居会有影响） 中的其他数据集上。

在某些情况下，Power BI 管理员可以请求数据集所有者，创建小于通过创建仪表板 （用于缓存的磁贴刷新哪些查询定期使用的任何数据集） 而不是报表的易失性查询工作负荷。 这可以帮助防止加载仪表板时的峰值。 此解决方案可能始终无法为给定的业务要求，但它可以是避免 CPU 饱和所致，而无需进行更改为数据集的有效方法。

## <a name="acknowledgements"></a>确认

撰写本文时由 Peter Myers、 数据平台 MVP 和独立 BI 专家[位解决方案](https://www.bitwisesolutions.com.au/)。

## <a name="next-steps"></a>后续步骤

> [!div class="nextstepaction"]
> [监视与应用的高级容量](service-admin-premium-monitor-capacity.md)    
> [!div class="nextstepaction"]
> [在管理门户中监视容量](service-admin-premium-monitor-portal.md)   

更多问题？ [尝试咨询 Power BI 社区](https://community.powerbi.com/)

||||||